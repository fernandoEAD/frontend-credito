<div class="container">
  <div class="header">
    <h1>Consulta de Cr√©ditos</h1>
    <p>Digite o n√∫mero da NFS-e ou do Cr√©dito para realizar a consulta</p>
  </div>

  <form (ngSubmit)="buscar()" #form="ngForm" class="formulario">
        <div class="input-group">
      <input
        type="text"
        name="busca"
        [(ngModel)]="busca"
        placeholder="Digite o n√∫mero da NFS-e ou do Cr√©dito"
        required
        [disabled]="carregando"
        class="input-field"
        (keydown)="onEnterKey($event)"
        maxlength="50" />
      <button type="button"
              *ngIf="busca"
              (click)="limparBusca()"
              class="btn-limpar"
              [disabled]="carregando"
              title="Limpar busca">
        ‚úï
      </button>
      <button type="submit" [disabled]="!busca || carregando" class="btn-buscar">
        <span *ngIf="!carregando">Buscar</span>
        <span *ngIf="carregando">Buscando...</span>
      </button>
    </div>
  </form>

  <!-- Loading indicator -->
  <div *ngIf="carregando" class="loading">
    <div class="spinner"></div>
    <p>Consultando cr√©ditos...</p>
  </div>

  <!-- Mensagem de erro -->
  <div *ngIf="erro" class="error-message">
    <p>{{ erro }}</p>
    <button (click)="limparErro()" class="btn-fechar">√ó</button>
  </div>

  <!-- Resultados -->
  <div *ngIf="resultado.length > 0 && !carregando" class="resultados">
    <h2>Resultado da Consulta</h2>
    <div class="info-resultados">
      <p>{{ resultado.length }} cr√©dito(s) encontrado(s)</p>
    </div>

    <div class="table-container">
      <table class="table-creditos">
        <thead>
          <tr>
            <th>N√∫mero Cr√©dito</th>
            <th>N√∫mero NFS-e</th>
            <th>Data Constitui√ß√£o</th>
            <th>Valor ISSQN</th>
            <th>Tipo Cr√©dito</th>
            <th>Simples Nacional</th>
            <th>Al√≠quota</th>
            <th>Valor Faturado</th>
            <th>Valor Dedu√ß√£o</th>
            <th>Base C√°lculo</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of resultado" class="row-credito">
            <td class="numero-credito">{{ item.numeroCredito }}</td>
            <td class="numero-nfse">{{ item.numeroNfse }}</td>
            <td class="data">{{ item.dataConstituicao | date:'dd/MM/yyyy' }}</td>
            <td class="valor">{{ item.valorIssqn | currency:'BRL':'symbol':'1.2-2' }}</td>
            <td class="tipo">
              <span class="badge" [class]="'badge-' + item.tipoCredito.toLowerCase()">
                {{ item.tipoCredito }}
              </span>
            </td>
            <td class="simples">
              <span class="status" [class]="item.simplesNacional ? 'status-sim' : 'status-nao'">
                {{ item.simplesNacional ? 'Sim' : 'N√£o' }}
              </span>
            </td>
            <td class="aliquota">{{ item.aliquota | number:'1.1-1' }}%</td>
            <td class="valor">{{ item.valorFaturado | currency:'BRL':'symbol':'1.2-2' }}</td>
            <td class="valor">{{ item.valorDeducao | currency:'BRL':'symbol':'1.2-2' }}</td>
            <td class="valor">{{ item.baseCalculo | currency:'BRL':'symbol':'1.2-2' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Mensagem quando n√£o h√° resultados -->
  <div *ngIf="!carregando && !erro && buscaRealizada && resultado.length === 0" class="no-results">
    <div class="no-results-icon">üîç</div>
    <h3>Nenhum cr√©dito encontrado</h3>
    <p>Verifique se o n√∫mero informado est√° correto e tente novamente.</p>
  </div>
</div>
